<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Bingo Auth Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-slate-900 flex items-center justify-center">
    <div
      class="w-full max-w-md bg-slate-800/80 text-slate-50 rounded-2xl shadow-xl p-8 border border-slate-700"
    >
      <h1 class="text-2xl font-bold mb-2 text-center">Bingo Auth Test</h1>
      <p class="text-sm text-slate-300 mb-6 text-center">
        Test Google login via Better Auth and inspect your session.
      </p>

      <div class="space-y-4">
        <!-- Sign in button -->
        <button
          onclick="loginWithGoogle()"
          class="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl border border-slate-600 bg-slate-700 hover:bg-slate-600 transition text-sm font-medium"
        >
          <svg
            class="w-5 h-5"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 48 48"
          >
            <path
              fill="#FFC107"
              d="M43.6 20.5H42V20H24v8h11.3C33.8 32.9 29.3 36 24 36c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 6 1.1 8.2 3l5.7-5.7C34.6 4.1 29.6 2 24 2 12.3 2 3 11.3 3 23s9.3 21 21 21 21-9.3 21-21c0-1.3-.1-2.1-.4-3.5z"
            />
            <path
              fill="#FF3D00"
              d="M6.3 14.7l6.6 4.8C14.4 16.2 18.8 13 24 13c3.1 0 6 1.1 8.2 3l5.7-5.7C34.6 4.1 29.6 2 24 2 16.1 2 9.1 6.5 6.3 14.7z"
            />
            <path
              fill="#4CAF50"
              d="M24 44c5.2 0 10.1-2 13.7-5.3l-6.3-5.3C29.2 34.8 26.7 36 24 36c-5.2 0-9.7-3.1-11.7-7.6l-6.5 5C9.1 41.5 16.1 44 24 44z"
            />
            <path
              fill="#1976D2"
              d="M43.6 20.5H42V20H24v8h11.3c-1.1 2.5-3 4.6-5.6 6l.1.1 6.3 5.3C38.1 42.6 42 38 43.6 32c.7-2.1 1.1-4.3 1.1-6.8 0-1.3-.1-2.1-.4-3.7z"
            />
          </svg>
          <span>Sign in with Google</span>
        </button>

        <!-- Check session -->
        <button
          onclick="checkSession()"
          class="w-full inline-flex items-center justify-center px-4 py-2.5 rounded-xl border border-emerald-500/70 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-200 text-sm font-medium transition"
        >
          Check /api/auth/me
        </button>

        <!-- Session output -->
        <div class="mt-4">
          <p class="text-xs text-slate-400 mb-1">Session response:</p>
          <pre
            id="session-output"
            class="text-xs bg-slate-900/70 border border-slate-700 rounded-xl p-3 overflow-x-auto max-h-60"
          >
Click "Sign in with Google", complete login, then click "Check /api/auth/me".</pre
          >
        </div>
      </div>
    </div>

    <script>
      async function loginWithGoogle() {
        const callbackURL = window.location.origin;

        try {
          // ðŸ”¥ Correct: POST to /sign-in/social
          const res = await fetch(
            "http://localhost:3000/api/auth/sign-in/social",
            {
              method: "POST",
              credentials: "include",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                provider: "google",
                callbackURL,
              }),
            },
          );

          const data = await res.json();
          console.log("sign-in/social response:", data);

          // Better Auth returns { redirect: true, url: "https://accounts.google.com/..." }
          if (data.redirect && data.url) {
            window.location.href = data.url;
          } else {
            alert("Unexpected response, check console.");
          }
        } catch (err) {
          console.error(err);
          alert("Error during sign-in: " + err.message);
        }
      }

      async function checkSession() {
        const output = document.getElementById("session-output");
        output.textContent = "Loading...";

        try {
          const res = await fetch("http://localhost:3000/api/auth/me", {
            method: "GET",
            credentials: "include", // send cookies
          });

          const data = await res.json();
          output.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          output.textContent = "Error: " + err.message;
        }
      }
    </script>
  </body>
</html>